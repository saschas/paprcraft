jQuery(document).ready(function($){function e(){d=requestAnimationFrame(e),h.getByteFrequencyData(g),console.log(g),m.fillStyle="rgba(40,157,238,.05)",m.fillRect(0,0,window.innerWidth,window.innerHeight);var n=g.length;m.fillStyle="#fff";for(var t=window.innerWidth/n,i=0;n>i;i++)0!=g[i]&&(m.font="12px serif",m.fillStyle="rgba(255,255,255,1)",m.fillRect(t*i,2*s,t,-g[i]),m.fillStyle="rgba(40,157,238,1)",m.fillText(g[i],t*i+15,c.height),m.fillStyle="rgba(255,255,255,1)",m.fillRect(window.innerWidth-t*i,2*s,t,-g[i]),m.fillStyle="rgba(40,157,238,1)",m.fillText(g[i],window.innerWidth-t*i+15,c.height));m.beginPath(),m.strokeStyle="tomato";for(var i=0;n>i;i++)0!=g[i]&&m.lineTo(f+f/g.length*i,s+g[i]);m.stroke(),m.beginPath();for(var i=0;n>i;i++)0!=g[i]&&m.lineTo(f-f/g.length*i,s+g[i]);m.strokeStyle="tomato",m.stroke(),m.beginPath(),m.strokeStyle="#eeeeee";for(var i=0;n>i;i++)0!=g[i]&&m.lineTo(f+f/g.length*i,s-g[i]);m.stroke(),m.beginPath(),m.strokeStyle="#eeeeee";for(var i=0;n>i;i++)0!=g[i]&&m.lineTo(f-f/g.length*i,s-g[i]);return m.stroke(),d}function n(){c.width=window.innerWidth,c.height=window.innerHeight-.25*window.innerHeight+2,f=c.width/2,s=c.height/2}function t(e){return h=i.createAnalyser(),h.fftSize=64,g=new Uint8Array(h.frequencyBinCount),y=100/h.frequencyBinCount,p=i.createMediaElementSource(e),p.connect(h),h.connect(i.destination),!0}var i;"undefined"!=typeof AudioContext?i=new AudioContext:"undefined"!=typeof webkitAudioContext&&(i=new webkitAudioContext);for(var o=0,a=["ms","moz","webkit","o"],r=0;r<a.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[a[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[r]+"CancelAnimationFrame"]||window[a[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var t=(new Date).getTime(),i=Math.max(0,16-(t-o)),a=window.setTimeout(function(){e(t+i)},i);return o=t+i,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var l={},d,u=4,w=50,c=document.getElementById("c"),f,s,m=c.getContext("2d");n(),window.onresize=n;var h,g,y,p;$("#player").bind({progress:function(e){console.log(e)},canplaythrough:function(){$(".play-button").addClass("canplay")},play:function(){console.log(this.audioInit),void 0===this.audioInit&&(this.audioInit=t(this)),d=e()},pause:function(){cancelAnimationFrame(d)},ended:function(){$(".play-button").removeClass("on")}}),$(".play-button").click(function(){$("#player").get(0).paused?($("#player").get(0).play(),$(this).addClass("on")):($("#player").get(0).pause(),$(this).removeClass("on"))})});